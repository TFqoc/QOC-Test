<odoo>
  <data>

    <template id="listing">
      <ul>
        <li t-foreach="objects" t-as="object">
          <a t-attf-href="#{ root }/objects/#{ object.id }">
            <t t-esc="object.display_name" />
          </a>
        </li>
      </ul>
    </template>
    <template id="object">
      <h1>
        <t t-esc="object.display_name" />
      </h1>
      <dl>
        <t t-foreach="object._fields" t-as="field">
          <dt>
            <t t-esc="field" />
          </dt>
          <dd>
            <t t-esc="object[field]" />
          </dd>
        </t>
      </dl>
    </template>
    <template id="mo_lines">
      <t t-if="len(objects) > 0">
        <div class="o_list_view">
          <div class="table-responsive">
            <table class="o_list_table table table-sm table-hover table-striped o_list_table_ungrouped" style="table-layout: fixed;">
              <thead>
                <tr>
                  <th>Order Name</th>
                  <!-- <th>Part #</th> -->
                  <th>Qty</th>
                  <th>Start Date</th>
                  <!-- <th>Deadline</th> -->
                </tr>
              </thead>
              <tbody>
                <t t-foreach="objects" t-as="mo_line">
                  <!-- <t t-set="components" t-value="mo_line.move_raw_ids" /> -->
                  <t t-set="workorders" t-value="mo_line.workorder_ids" />
                  <tr>
                    <td>
                      <t t-if="len(workorders) > 0">
                        <span class="fa fa-caret-right" onclick="toggle_dropdown(this)" style="padding-left: 2px; padding-right: 5px;" />
                      </t>
                      <span>
                        <a t-attf-href="#id={{mo_line.id}}&amp;model=mrp.production">
                          <t t-esc="mo_line.name" />
                        </a>
                      </span>
                    </td>
                    <!-- <td>
                      <t t-esc="mo_line.product_id.default_code" />
                    </td> -->
                    <td>
                      <t t-esc="mo_line.product_qty" />
                    </td>
                    <!-- <td>
                      <t t-esc="mo_line.date_planned_start.strftime('%m/%d/%Y') if mo_line.date_planned_start else ''" />
                    </td> -->
                    <td>
                      <t t-esc="mo_line.date_deadline.strftime('%m/%d/%Y') if mo_line.date_deadline else ''" />
                    </td>
                  </tr>
                  <t t-if="len(workorders) > 0">
                    <tr class="dropdown-content mo-content">
                      <td colspan="3" style="padding-left: 10px;">
                        <table class="o_list_table table table-sm table-hover table-striped o_list_table_ungrouped" style="table-layout: fixed;">
                          <thead>
                            <tr>
                              <!-- <th>Component</th>
                              <th>Quantity to Consume</th> -->
                              <th>Operation</th>
                              <th>Start Date</th>
                              <th>Status</th>
                            </tr>
                          </thead>
                          <tbody>
                            <t t-foreach="workorders" t-as="workorder">
                              <tr>
                                <td>
                                  <a t-attf-href="#id={{workorder.id}}&amp;model=mrp.workorder">
                                    <t t-esc="workorder.name" />
                                  </a>
                                </td>
                                <td>
                                  <t t-esc="workorder.date_planned_start.strftime('%m/%d/%Y') if workorder.date_planned_start else ''" />
                                </td>
                                <td>
                                  <t t-esc="workorder.state" />
                                </td>
                              </tr>
                              <t t-if="workorder.component_id">
                                <tr class="dropdown-content">
                                  <td colspan="3" style="padding-left: 10px;">
                                    <table class="o_list_table table table-sm table-hover table-striped o_list_table_ungrouped" style="table-layout: fixed;">
                                      <thead>
                                        <tr>
                                          <th>Component Name</th>
                                          <th>Quantity to Consume</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        <tr onclick="get_data(this,'mo_data_product')" t-attf-model_id="{{workorder.component_id.id}}">
                                          <td>
                                            <a t-attf-href="#id={{workorder.component_id.id}}&amp;model=product.product">
                                              <t t-esc="workorder.component_id.name" />
                                            </a>
                                          </td>
                                          <td>
                                            <!-- <t t-esc="workorder.component_remaining_qty"/> / <t t-esc="workorder.component_qty_to_do"/> -->
                                          </td>
                                        </tr>
                                      </tbody>
                                    </table>
                                  </td>
                                </tr>
                              </t>
                            </t>
                          </tbody>
                        </table>
                      </td>
                    </tr>
                  </t>
                </t>
              </tbody>
            </table>
          </div>
        </div>
      </t>
      <t t-else="">
        <h3>No current manufacturing orders were found for this product.</h3>
      </t>
      <!-- Collapse all dropdowns -->
      <script>
        // TODO only close dropdowns on the current box
        $(this).closest(".ds_card").find(".dropdown-content.mo-content").hide();
        //$(".dropdown-content.mo-content").hide();
      </script>
    </template>

    <template id="wo_lines">
      <t t-if="len(objects) > 0">
        <div class="o_list_view">
          <div class="table-responsive">
            <table class="o_list_table table table-sm table-hover table-striped o_list_table_ungrouped" style="table-layout: fixed;">
              <thead>
                <tr>
                  <th>Operation</th>
                  <th>Start Date</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <t t-foreach="objects" t-as="wo_line">
                  <tr>
                    <td>
                      <span>
                        <a t-attf-href="#id={{wo_line.id}}&amp;model=mrp.workorder">
                          <t t-esc="wo_line.name" />
                        </a>
                      </span>
                    </td>
                    <td>
                      <t t-esc="wo_line.date_planned_start.strftime('%m/%d/%Y') if wo_line.date_planned_start else ''" />
                    </td>
                    <td>
                      <t t-esc="wo_line.state" />
                    </td>
                  </tr>
                </t>
              </tbody>
            </table>
          </div>
        </div>
      </t>
      <t t-else="">
        <h3>No current work orders were found for this manufacturing order.</h3>
      </t>
    </template>

  </data>
</odoo>